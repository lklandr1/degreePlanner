<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Degree Planner - Sign Up</title>
</head>

<style type="text/css">

	@font-face{
		font-family: headFont;
		src: url(ui/fonts/Montserrat-VariableFont_wght.ttf)
	}

	@font-face{
		font-family: bodyFont;
		src: url(ui/fonts/Roboto-VariableFont_wdth,wght.ttf)
	}
	
	#wrapper{
		min-width:1000px;
		min-height:200%;
		margin: auto;
		background-color: #5B6770;
		font-family: bodyFont;
	}

    #header{
		background-color: #14213D;
        width: 100%;
		font-size: 40px;
		color: #FFFFFF;
		text-align: center;
		line-height: 70px;
		font-family: headFont;
	}

    #error{
        text-align: center;
        color: red;
        padding: 0.5em;
        display: none;
    }

    form{
        margin: auto;
        padding: 10px;
        background: #5B6770;
        align-items: center;
    }

    input[type=text], input[type=email], input[type=password], input[type=button]{
        margin: 5px;
        padding: 10px;
        border: 1px solid black;
        border-radius: 5px;
        width: 95%;
        font-family: bodyFont;
        cursor: pointer;
    }

    input[type=button]{
        width:97.3%
    }

    input[type=radio]{
        transform: scale(1.1);
    }

</style>

<body>

	<div id="wrapper">

        <div id="header">
            Degree Planner
            <div style="font-size: 16px; font-family: bodyFont;">Sign Up</div>
        </div>
        <div id="error"></div>


        <form id="signup_form">
            <input type="text" name="username" placeholder="Username"><br>
            <input type="email" name="email" placeholder="Email"><br>
            <input type="password" name="password" placeholder="Password"><br>
            <input type="password" name="password2" placeholder="Confirm Password"><br>
            <input type="button" value="Sign Up" id="signup_button"><br>
            <input type="button" value="Log In" id="login_button"><br>
        </form>

	</div>

</body>
</html>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBik2Dr_kmYcE68RU7Ap15rSUXGtFHaspI",
  authDomain: "degreeplanner-2e548.firebaseapp.com",
  databaseURL: "https://degreeplanner-2e548-default-rtdb.firebaseio.com",
  projectId: "degreeplanner-2e548",
  storageBucket: "degreeplanner-2e548.appspot.com",
  messagingSenderId: "320135681060",
  appId: "1:320135681060:web:0347b73335827034f334b1"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

function _(element){
    return document.getElementById(element);
}

const signup_button = _("signup_button");
signup_button.addEventListener("click", firebaseSignup);

const login_button = _("login_button");
login_button.addEventListener("click", log_in);

function log_in(){
    window.location = "/login";
}

function firebaseSignup(){
    signup_button.disabled = true;
    signup_button.value = "Loading";

    const form = _("signup_form");
    const username = form.username.value;
    const email = form.email.value;
    const password = form.password.value;
    const password2 = form.password2.value;

    if(password !== password2){
        _("error").innerHTML = "Passwords do not match.";
        _("error").style.display = "block";
        signup_button.disabled = false;
        signup_button.value = "Sign Up";
        return;
    }

    createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed up
            const user = userCredential.user;
            // Save additional user info in Realtime Database
            return set(ref(database, 'users/' + user.uid), {
                username: username,
                email: email,
                createdAt: new Date().toISOString()
            });
        })
        .then(() => {
            alert("Your profile was created.");
            window.location = "/login";
        })
        .catch((error) => {
            _("error").innerHTML = error.message;
            _("error").style.display = "block";
        })
        .finally(() => {
            signup_button.disabled = false;
            signup_button.value = "Sign Up";
        });
}
</script>